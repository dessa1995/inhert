<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>상속법 사례 분석 시뮬레이터 - 미리보기</title>
    <style>
        :root {
            --primary-bg: #1a1a2e;
            --secondary-bg: #16213e;
            --card-bg: #0f3460;
            --text-color: #e94560;
            --body-text-color: #dcdcdc;
            --accent-color: #16c79a;
            --error-color: #e94560;
            --font-main: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            font-family: var(--font-main);
            background-color: var(--primary-bg);
            color: var(--body-text-color);
            overflow: hidden;
        }

        .simulator-container {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #scene-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        .ui-container {
            position: relative;
            z-index: 2;
            width: 90%;
            max-width: 800px;
            background-color: rgba(15, 52, 96, 0.85);
            backdrop-filter: blur(10px);
            border: 1px solid var(--text-color);
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 0 30px rgba(233, 69, 96, 0.5);
            animation: fadeIn 1s ease-in-out;
            max-height: 90vh;
            overflow-y: auto;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid var(--text-color);
            padding-bottom: 1rem;
            margin-bottom: 1.5rem;
        }

        .header h1 {
            color: var(--text-color);
            margin: 0;
            font-size: 1.8rem;
        }

        #score-display {
            background-color: var(--accent-color);
            color: var(--primary-bg);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-weight: bold;
            font-size: 1.2rem;
        }

        #scenario-text {
            background-color: var(--secondary-bg);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            line-height: 1.6;
            font-size: 1rem;
        }
        
        #interaction-area h3 {
            color: var(--accent-color);
            margin-bottom: 1rem;
        }

        #heir-options, #amount-inputs {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .heir-option label {
            display: flex;
            align-items: center;
            background-color: var(--secondary-bg);
            padding: 0.8rem;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
        }
        
        .heir-option label:hover {
            background-color: var(--card-bg);
            transform: scale(1.02);
        }
        
        .heir-option input[type="checkbox"] {
            margin-right: 1rem;
            width: 20px;
            height: 20px;
        }

        .amount-input-group {
            display: flex;
            align-items: center;
            gap: 1rem;
            background-color: var(--secondary-bg);
            padding: 0.5rem 1rem;
            border-radius: 5px;
        }
        
        .amount-input-group label {
            flex-shrink: 0;
            width: 80px;
            font-weight: bold;
        }
        
        .amount-input-group input {
            width: 100%;
            padding: 0.5rem;
            border-radius: 4px;
            border: 1px solid var(--accent-color);
            background-color: var(--primary-bg);
            color: var(--body-text-color);
            font-size: 1rem;
        }
        
        .amount-input-group .unit-helper {
            font-size: 0.9rem;
            color: #aaa;
        }

        .button-container {
            text-align: center;
            margin-top: 2rem;
        }

        .action-btn {
            padding: 0.8rem 2rem;
            font-size: 1.1rem;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--primary-bg);
            margin: 0 0.5rem;
        }

        #submit-btn {
            background-color: var(--accent-color);
        }
        
        #submit-btn:hover {
            box-shadow: 0 0 15px var(--accent-color);
        }

        #next-btn {
            background-color: var(--text-color);
            display: none; /* Initially hidden */
        }

        #next-btn:hover {
            box-shadow: 0 0 15px var(--text-color);
        }

        /* Modal for results */
        #modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            animation: fadeIn 0.5s;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.9);
            background-color: var(--secondary-bg);
            padding: 2rem;
            border-radius: 10px;
            width: 80%;
            max-width: 600px;
            border-top: 5px solid;
            animation: slideIn 0.5s forwards;
        }
        
        #modal-result {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 1rem;
            text-align: center;
        }
        
        #modal-explanation {
            background-color: var(--primary-bg);
            padding: 1rem;
            border-radius: 5px;
            line-height: 1.7;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from {
                transform: translate(-50%, -70%) scale(0.8);
                opacity: 0;
            }
            to {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .header h1 { font-size: 1.4rem; }
            .ui-container { padding: 1.5rem; width: 95%; }
            .amount-input-group { flex-direction: column; align-items: flex-start; }
            .amount-input-group label { width: auto; margin-bottom: 0.5rem; }
            .amount-input-group input { width: calc(100% - 1rem); }
        }

    </style>
</head>
<body>

    <div class="simulator-container">
        <div id="scene-container"></div>
        <div class="ui-container">
            <div class="header">
                <h1>상속법 사례 분석</h1>
                <div id="score-display">점수: 0</div>
            </div>
            
            <div id="scenario-text">
                사례를 불러오는 중입니다...
            </div>
            
            <div id="interaction-area">
                <h3>1. 상속인을 모두 선택하세요.</h3>
                <div id="heir-options"></div>

                <h3>2. 상속인별 상속액을 입력하세요.</h3>
                <div id="amount-inputs"></div>
            </div>

            <div class="button-container">
                <button id="submit-btn" class="action-btn">결과 확인</button>
                <button id="next-btn" class="action-btn">다음 문제</button>
            </div>
        </div>
    </div>

    <div id="modal">
        <div class="modal-content">
            <h2 id="modal-result"></h2>
            <div id="modal-explanation"></div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        // --- 3D Background Scene ---
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.getElementById('scene-container').appendChild(renderer.domElement);

        // Simple 3D object - a rotating legal document scroll
        const geometry = new THREE.CylinderGeometry(0.5, 0.5, 3, 32);
        const textureLoader = new THREE.TextureLoader();
        // A placeholder texture to simulate text on a document
        const material = new THREE.MeshStandardMaterial({ 
            color: 0xfff8e1, 
            roughness: 0.7,
            metalness: 0.1,
            map: textureLoader.load('https://threejs.org/examples/textures/uv_grid_opengl.jpg') // Placeholder texture
        });
        const scroll = new THREE.Mesh(geometry, material);
        scene.add(scroll);
        
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
        scene.add(ambientLight);
        const pointLight = new THREE.PointLight(0xffffff, 1);
        pointLight.position.set(5, 5, 5);
        scene.add(pointLight);

        camera.position.z = 5;

        function animate3D() {
            requestAnimationFrame(animate3D);
            scroll.rotation.x += 0.005;
            scroll.rotation.y += 0.005;
            renderer.render(scene, camera);
        }
        animate3D();

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // --- Simulator Logic ---
        const scenarios = [
            {
                id: 1,
                text: "A는 배우자 B, 자녀 C, D를 남기고 140억원의 재산을 남긴 채 사망했습니다. A의 형제 E도 있었습니다. 상속인과 각자의 상속액은 얼마일까요?",
                possible_heirs: ["배우자 B", "자녀 C", "자녀 D", "형제 E"],
                solution: {
                    heirs: ["배우자 B", "자녀 C", "자녀 D"],
                    amounts: {
                        "배우자 B": 6000000000,
                        "자녀 C": 4000000000,
                        "자녀 D": 4000000000,
                    }
                },
                explanation: "배우자와 직계비속(자녀)이 공동 상속인이므로 1순위 상속인입니다. 형제 E는 후순위로 상속권이 없습니다. 배우자는 자녀 상속분의 1.5배를 받으므로, 상속 비율은 B:C:D = 1.5:1:1 이 됩니다. 따라서 B는 60억, C와 D는 각각 40억을 상속받습니다."
            },
            {
                id: 2,
                text: "부자 A는 이혼한 전 배우자 B와의 자녀 C가 있습니다. A는 D와 사실혼 관계에서 자녀 E를 낳고 인지했습니다. A는 '내 재산 70억 전부를 C에게 물려준다'는 유언을 남기고 사망했습니다. 상속인과 각자의 최종 상속액은 얼마일까요? (단, E는 유류분을 청구함)",
                possible_heirs: ["자녀 C", "사실혼 D", "자녀 E"],
                solution: {
                    heirs: ["자녀 C", "자녀 E"],
                    amounts: {
                        "자녀 C": 5250000000,
                        "자녀 E": 1750000000
                    }
                },
                explanation: "유언에 따라 C가 70억을 모두 상속받는 것이 원칙입니다. 하지만 직계비속인 E는 법정 상속분(35억)의 1/2인 17.5억을 유류분으로 청구할 수 있습니다. 사실혼 관계인 D는 상속권이 없습니다. 따라서 E가 유류분을 청구하면 최종적으로 C는 52.5억, E는 17.5억을 상속받게 됩니다."
            },
            // Add more scenarios here...
        ];

        let currentScore = 0;
        let currentScenario = {};
        let usedIndices = new Set();

        const scoreDisplay = document.getElementById('score-display');
        const scenarioText = document.getElementById('scenario-text');
        const heirOptionsContainer = document.getElementById('heir-options');
        const amountInputsContainer = document.getElementById('amount-inputs');
        const submitBtn = document.getElementById('submit-btn');
        const nextBtn = document.getElementById('next-btn');
        const modal = document.getElementById('modal');
        const modalResult = document.getElementById('modal-result');
        const modalExplanation = document.getElementById('modal-explanation');

        function formatCurrency(amount) {
            if (amount >= 100000000) {
                const eok = Math.floor(amount / 100000000);
                const man = Math.round((amount % 100000000) / 10000);
                return man > 0 ? `${eok}억 ${man}만원` : `${eok}억원`;
            } else {
                return `${amount / 10000}만원`;
            }
        }
        
        function parseAmount(inputStr) {
            let total = 0;
            const eokMatch = inputStr.match(/(\d+)\s*억/);
            const manMatch = inputStr.match(/(\d+)\s*만/);
            if(eokMatch) total += parseInt(eokMatch[1]) * 100000000;
            if(manMatch) total += parseInt(manMatch[1]) * 10000;
            if (!eokMatch && !manMatch && !isNaN(parseInt(inputStr.replace(/,/g, '')))) {
                 total += parseInt(inputStr.replace(/,/g, ''));
            }
            return total;
        }


        function loadScenario() {
            if (usedIndices.size === scenarios.length) {
                scenarioText.innerHTML = "모든 문제를 다 푸셨습니다! 최종 점수를 확인하세요.";
                submitBtn.style.display = 'none';
                nextBtn.style.display = 'none';
                return;
            }

            let randomIndex;
            do {
                randomIndex = Math.floor(Math.random() * scenarios.length);
            } while (usedIndices.has(randomIndex));
            
            usedIndices.add(randomIndex);
            currentScenario = scenarios[randomIndex];

            scenarioText.innerHTML = currentScenario.text;
            heirOptionsContainer.innerHTML = '';
            amountInputsContainer.innerHTML = '';
            
            currentScenario.possible_heirs.forEach(heir => {
                const heirId = `heir_${heir.replace(/\s/g, '')}`;
                heirOptionsContainer.innerHTML += `
                    <div class="heir-option">
                        <label for="${heirId}">
                            <input type="checkbox" id="${heirId}" name="heirs" value="${heir}">
                            <span>${heir}</span>
                        </label>
                    </div>
                `;
            });
            
            // Add event listeners to checkboxes to show/hide amount inputs
            document.querySelectorAll('input[name="heirs"]').forEach(checkbox => {
                checkbox.addEventListener('change', updateAmountInputs);
            });

            updateAmountInputs(); // Initial call
            
            submitBtn.style.display = 'inline-block';
            nextBtn.style.display = 'none';
        }
        
        function updateAmountInputs() {
            amountInputsContainer.innerHTML = '';
            const selectedHeirs = Array.from(document.querySelectorAll('input[name="heirs"]:checked')).map(cb => cb.value);
            
            selectedHeirs.forEach(heir => {
                const inputId = `amount_${heir.replace(/\s/g, '')}`;
                amountInputsContainer.innerHTML += `
                    <div class="amount-input-group">
                         <label for="${inputId}">${heir}:</label>
                         <input type="text" id="${inputId}" placeholder="예: 52억 5000만원">
                         <span class="unit-helper">억원/만원 단위로 입력</span>
                    </div>
                `;
            });
        }

        function checkAnswer() {
            const selectedHeirs = new Set(Array.from(document.querySelectorAll('input[name="heirs"]:checked')).map(cb => cb.value));
            const correctHeirs = new Set(currentScenario.solution.heirs);

            let isHeirCorrect = selectedHeirs.size === correctHeirs.size && [...selectedHeirs].every(heir => correctHeirs.has(heir));
            
            let isAmountCorrect = true;
            if (isHeirCorrect) {
                for(const heir of correctHeirs) {
                    const inputId = `amount_${heir.replace(/\s/g, '')}`;
                    const userInput = document.getElementById(inputId).value;
                    const userAmount = parseAmount(userInput);
                    if(userAmount !== currentScenario.solution.amounts[heir]) {
                        isAmountCorrect = false;
                        break;
                    }
                }
            } else {
                isAmountCorrect = false;
            }

            modal.style.display = 'block';
            modalExplanation.innerHTML = `<strong>해설:</strong> ${currentScenario.explanation}`;

            if (isHeirCorrect && isAmountCorrect) {
                modalResult.textContent = "정답입니다!";
                modalResult.style.color = "var(--accent-color)";
                modal.querySelector('.modal-content').style.borderColor = "var(--accent-color)";
                currentScore += 10;
                scoreDisplay.textContent = `점수: ${currentScore}`;
                 // Correct animation
                scoreDisplay.style.transform = 'scale(1.2)';
                setTimeout(() => { scoreDisplay.style.transform = 'scale(1)'; }, 300);
            } else {
                modalResult.textContent = "오답입니다.";
                modalResult.style.color = "var(--error-color)";
                modal.querySelector('.modal-content').style.borderColor = "var(--error-color)";
            }
            
            submitBtn.style.display = 'none';
            nextBtn.style.display = 'inline-block';
        }

        submitBtn.addEventListener('click', checkAnswer);
        nextBtn.addEventListener('click', () => {
            modal.style.display = 'none';
            loadScenario();
        });
        
        // Close modal if clicked outside
        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                modal.style.display = 'none';
            }
        });

        // Initial Load
        loadScenario();
    </script>
</body>
</html>
